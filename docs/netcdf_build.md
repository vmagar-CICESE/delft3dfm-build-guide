# Building NetCDF for Delft3D-FM

This guide documents the complete process for building NetCDF libraries for Delft3D-FM, including troubleshooting steps for common issues.

## Prerequisites

- GCC compiler suite
- Intel Fortran compiler (for NetCDF Fortran compatibility)
- HDF5 libraries
- zlib development libraries

```bash
# Install required dependencies
sudo apt-get update
sudo apt-get install -y build-essential m4 wget curl
sudo apt-get install -y libhdf5-serial-dev hdf5-tools libcurl4-openssl-dev zlib1g-dev
```

## Prepare Build Directory
```bash
# Create and enter directory for NetCDF build
mkdir -p ~/intel-netcdf
cd ~/intel-netcdf
```

## Build NetCDF C Library

```bash
# Download NetCDF C
wget https://downloads.unidata.ucar.edu/netcdf-c/4.9.0/netcdf-c-4.9.0.tar.gz
tar xzf netcdf-c-4.9.0.tar.gz
cd netcdf-c-4.9.0

# Configure with proper HDF5 paths
CC=gcc CPPFLAGS="-I/usr/include/hdf5/serial" LDFLAGS="-L/usr/lib/x86_64-linux-gnu/hdf5/serial" ./configure --prefix=$HOME/intel-netcdf

# Build and install
make
make install
cd ..
```

## Build NetCDF Fortran Library

```bash
# Download NetCDF Fortran
wget https://downloads.unidata.ucar.edu/netcdf-fortran/4.6.0/netcdf-fortran-4.6.0.tar.gz
tar xzf netcdf-fortran-4.6.0.tar.gz
cd netcdf-fortran-4.6.0

# Set environment variables for NetCDF
export LD_LIBRARY_PATH=$HOME/intel-netcdf/lib:$LD_LIBRARY_PATH
export CPPFLAGS="-I$HOME/intel-netcdf/include"
export LDFLAGS="-L$HOME/intel-netcdf/lib"

# Configure with Intel Fortran compiler
FC=mpiifort ./configure --prefix=$HOME/intel-netcdf

# Build and install
make
make install
```

## Environment Setup for Delft3D-FM


Add these lines to your .bashrc or sourcing script:

```bash
export NETCDF_HOME=$HOME/intel-netcdf
export LD_LIBRARY_PATH=$NETCDF_HOME/lib:$LD_LIBRARY_PATH
export PATH=$NETCDF_HOME/bin:$PATH
```

## Testing NetCDF Installation

Verify that your NetCDF installation works correctly:

```bash
# Check NetCDF C version
$HOME/intel-netcdf/bin/nc-config --version

# Check NetCDF Fortran version
$HOME/intel-netcdf/bin/nf-config --version

# Make sure netcdf.mod is available for Intel Fortran
ls $HOME/intel-netcdf/include/netcdf.mod
```

## Common Issues and Solutions

### Missing HDF5 Libraries

**Error:** 
Can't find or can't compile with the hdf5 library

**Solution:**

# Make sure HDF5 paths are correctly specified:
CPPFLAGS="-I/usr/include/hdf5/serial" LDFLAGS="-L/usr/lib/x86_64-linux-gnu/hdf5/serial"


### Module incompatibility

**Error:**

netcdf_utils.F90(33): error #7013: This module file was not generated by any release of this compiler. [NETCDF]



**Solution:**
This happens when NetCDF was built with a different compiler than what's used for Delft3D-FM. Always build NetCDF Fortran with the same Intel compiler that you'll use for Delft3D-FM.